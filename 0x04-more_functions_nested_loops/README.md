Update on more functions, more nested loops
